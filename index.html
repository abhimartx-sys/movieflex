<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Flex - Live Cloud</title>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Aapka provide kiya hua Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDf9UsCb-75JMXcoGdIMOeBTSF3dxZOxzs",
            authDomain: "movieflex-5b19c.firebaseapp.com",
            databaseURL: "https://movieflex-5b19c-default-rtdb.firebaseio.com",
            projectId: "movieflex-5b19c",
            storageBucket: "movieflex-5b19c.firebasestorage.app",
            messagingSenderId: "805972078438",
            appId: "1:805972078438:web:3a0619ff51ca0b044f22a7",
            measurementId: "G-WZYK5L6SQS"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const movieCol = collection(db, "movies");

        // --- 1. Movie Upload Function (Admin) ---
        window.addMovie = async () => {
            const name = document.getElementById('movieName').value;
            const poster = document.getElementById('posterUrl').value;
            const link = document.getElementById('downloadUrl').value;

            if(!name || !poster || !link) {
                alert("Bhai, saari details bhariye!");
                return;
            }

            try {
                await addDoc(movieCol, {
                    name: name,
                    poster: poster,
                    link: link,
                    timestamp: Date.now()
                });
                alert("Movie successfully upload ho gayi!");
                // Clear inputs
                document.getElementById('movieName').value = '';
                document.getElementById('posterUrl').value = '';
                document.getElementById('downloadUrl').value = '';
            } catch (e) {
                alert("Error: " + e.message);
            }
        };

        // --- 2. Real-time Display (User View) ---
        const q = query(movieCol, orderBy("timestamp", "desc"));
        onSnapshot(q, (snapshot) => {
            const container = document.getElementById('movieGrid');
            container.innerHTML = '';
            
            snapshot.forEach((docSnap) => {
                const movie = docSnap.data();
                const card = `
                    <div class="card">
                        <img src="${movie.poster}" alt="${movie.name}" onerror="this.src='https://via.placeholder.com/200x300?text=No+Poster'">
                        <div class="info">
                            <h4>${movie.name}</h4>
                            <a href="${movie.link}" class="dl-btn" target="_blank">Download Movie</a>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        });
    </script>

    <style>
        body { background-color: #000; color: #fff; font-family: 'Arial', sans-serif; margin: 0; padding: 20px; }
        .logo { color: #e50914; font-size: 30px; font-weight: bold; text-align: center; margin-bottom: 30px; }
        
        /* Admin UI */
        .admin-panel { background: #1a1a1a; padding: 20px; border-radius: 10px; border: 1px solid #333; max-width: 500px; margin: 0 auto 40px auto; }
        .admin-panel h3 { margin-top: 0; color: #aaa; }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 5px; border: none; background: #333; color: white; box-sizing: border-box; }
        .up-btn { width: 100%; padding: 12px; background: #e50914; color: white; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; }
        
        /* Movie Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        .card { background: #111; border-radius: 8px; overflow: hidden; border: 1px solid #222; transition: 0.3s; }
        .card:hover { transform: scale(1.03); border-color: #e50914; }
        .card img { width: 100%; height: 260px; object-fit: cover; }
        .info { padding: 12px; text-align: center; }
        .info h4 { margin: 0 0 10px 0; font-size: 16px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .dl-btn { text-decoration: none; color: white; background: #333; padding: 8px 15px; display: block; border-radius: 4px; font-size: 14px; transition: 0.3s; }
        .dl-btn:hover { background: #e50914; }
    </style>
</head>
<body>

    <div class="logo">MOVIE FLEX ðŸŽ¬</div>

    <div class="admin-panel">
        <h3>Upload New Movie</h3>
        <input type="text" id="movieName" placeholder="Movie Name (e.g. Jawan)">
        <input type="text" id="posterUrl" placeholder="Poster Image URL">
        <input type="text" id="downloadUrl" placeholder="Download Link (G-Drive/Mega)">
        <button class="up-btn" onclick="addMovie()">Upload to Cloud Database</button>
    </div>

    <h2 style="border-left: 4px solid #e50914; padding-left: 10px;">Available Movies</h2>
    <div class="grid" id="movieGrid">
        </div>

</body>
</html>